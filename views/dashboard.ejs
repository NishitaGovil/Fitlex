<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitlex | Dashboard</title>
  <link rel="stylesheet" href="/css/dashboard.css" />
  <style>
    .dashboard-container { max-width: 900px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px; }
    h1 { text-align: center; color: #222; }
    .day-card { background: #f1f1f1; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
    .workout-title { font-weight: bold; margin-bottom: 8px; }
    .exercise-list { margin: 5px 0; padding-left: 20px; }
    .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
    .motivation-text { font-style: italic; font-size: 0.9rem; }
    .save-btn, .generate-plan-btn { margin-top: 20px; padding: 10px 15px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; display: inline-block; }
    .motivation-box { margin-top: 20px; padding: 15px; background: #ffeaa7; border-radius: 8px; text-align: center; font-weight: bold; }
  </style>
</head>
<body>

  <div class="navbar">
    <div class="logo">Fitlex</div>
    <div class="profile-section">
      <img src="https://www.shutterstock.com/image-vector/profile-icon-260nw-582976060.jpg" class="profile-icon" onclick="toggleMenu()" />
      <div id="profileMenu" class="profile-menu">
        <p><strong>Name:</strong> <%= user.name %></p>
        <p><strong>Email:</strong> <%= user.email %></p>
        <p><strong>Goal:</strong> <%= user.goal %></p>
        <form action="/logout" method="POST">
          <button type="submit" class="logout-btn">Logout</button>
        </form>
      </div>
    </div>
  </div>

  <div class="dashboard-container">
    <h1>Welcome, <span><%= user.name %></span></h1>

    <!-- Button to generate AI weekly plan -->
    <a href="#" class="generate-plan-btn" onclick="generateAIPlan()">Generate AI Weekly Plan ğŸ‹ï¸</a>

    <!-- Weekly Plan Container -->
    <div id="weeklyPlanContainer">
      <% if (typeof weeklyPlan !== "undefined" && weeklyPlan.length > 0) { %>
        <p>âœ… Progress: <span id="completedCount">0</span> / 7 days completed</p>

        <form action="/save-progress" method="POST" id="weeklyPlanForm">
          <% weeklyPlan.forEach(day => { %>
            <div class="day-card">
              <div class="workout-title"><%= day.day %>: <%= day.workout %></div>
              <ul class="exercise-list">
                <% day.exercises.forEach(ex => { %>
                  <li><%= ex %></li>
                <% }) %>
              </ul>
              <div class="card-footer">
                <small class="motivation-text">"<%= day.motivation %>"</small>
                <input 
                  type="checkbox" 
                  name="completedDays[]" 
                  class="day-checkbox"
                  onchange="updateProgress()"
                  <% if(day.completed) { %> checked <% } %>
                >
              </div>
            </div>
          <% }) %>

          <button type="submit" class="save-btn">Save Progress âœ…</button>
        </form>
      <% } %>
    </div>

    <div id="dynamicMotivation" class="motivation-box">
      ğŸŒ± Start today, your body will thank you!
    </div>
  </div>

<script>
  // Profile Dropdown
  function toggleMenu() {
    document.getElementById("profileMenu").classList.toggle("show");
  }

  window.onclick = function(e) {
    if (!e.target.matches('.profile-icon')) {
      let menu = document.getElementById("profileMenu");
      if (menu.classList.contains("show")) menu.classList.remove("show");
    }
  }

  // Progress Bar & Motivation
  function updateProgress() {
    const checkboxes = document.querySelectorAll('.day-checkbox');
    const completed = Array.from(checkboxes).filter(cb => cb.checked).length;
    document.getElementById("completedCount").innerText = completed;

    const messages = [
      "ğŸŒŸ Consistency is better than perfection!",
      "ğŸ”¥ Great start! You've got this!",
      "ğŸ’ª Two days down! Feeling stronger?",
      "ğŸš€ Almost halfway! Keep the momentum!",
      "âš¡ You're a machine! Keep going!",
      "ğŸ† So close to a perfect week!",
      "ğŸ‘‘ Final stretch! Finish strong!",
      "ğŸ‰ BOOM! Week completed! You're a legend!"
    ];

    document.getElementById("dynamicMotivation").innerText = messages[completed] || "ğŸŒ± Start today, your body will thank you!";
  }

  // Generate AI Plan dynamically
  function generateAIPlan() {
    const weeklyPlan = [
      { day: "Day 1", workout: "Basic full-body workout", exercises: ["Walking 20 mins","Bodyweight exercises","Chest and Triceps"], motivation: "Every step counts ğŸš€", completed: false },
      { day: "Day 2", workout: "Cardio full-body workout", exercises: ["Walking 20 mins","Bodyweight exercises","Back and Biceps"], motivation: "ğŸŒŸ Consistency is better than perfection!", completed: false },
      { day: "Day 3", workout: "Strength full-body workout", exercises: ["Walking 20 mins","Bodyweight exercises","Legs"], motivation: "ğŸ’ª Keep pushing your limits!", completed: false },
      { day: "Day 4", workout: "Balance full-body workout", exercises: ["Walking 20 mins","Bodyweight exercises","Shoulders and Abs"], motivation: "ğŸ§˜â€â™€ï¸ Focus on your form and balance!", completed: false },
      { day: "Day 5", workout: "HIIT full-body workout", exercises: ["Walking 20 mins","Bodyweight exercises","Full Body HIIT"], motivation: "ğŸ”¥ Push your limits and embrace the challenge!", completed: false },
      { day: "Day 6", workout: "Core + Cardio full-body workout", exercises: ["Walking 20 mins","Bodyweight exercises","Core + Cardio"], motivation: "ğŸ”¥ Keep up the momentum!", completed: false },
      { day: "Day 7", workout: "Active Recovery full-body workout", exercises: ["Walking 20 mins","Bodyweight exercises","Active Recovery"], motivation: "ğŸ§˜â€â™€ï¸ Rest and recharge!", completed: false }
    ];

    const container = document.getElementById("weeklyPlanContainer");
    container.innerHTML = `
      <p>âœ… Progress: <span id="completedCount">0</span> / 7 days completed</p>
      <form action="/save-progress" method="POST" id="weeklyPlanForm">
        ${weeklyPlan.map(day => `
          <div class="day-card">
            <div class="workout-title">${day.day}: ${day.workout}</div>
            <ul class="exercise-list">
              ${day.exercises.map(ex => `<li>${ex}</li>`).join('')}
            </ul>
            <div class="card-footer">
              <small class="motivation-text">"${day.motivation}"</small>
              <input type="checkbox" name="completedDays[]" class="day-checkbox" onchange="updateProgress()">
            </div>
          </div>
        `).join('')}
        <button type="submit" class="save-btn">Save Progress âœ…</button>
      </form>
    `;
    updateProgress();
  }
</script>

</body>
</html>