<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitlex | Dashboard</title>
  <link rel="stylesheet" href="/css/dashboard.css" />
</head>
<body>

  <div class="navbar">
    <div class="logo">Fitlex</div>
    <div class="profile-section">
      <img src="https://www.shutterstock.com/image-vector/profile-icon-260nw-582976060.jpg" class="profile-icon" onclick="toggleMenu()" />
      <div id="profileMenu" class="profile-menu">
        <p><strong>Name:</strong> <%= user.name %></p>
        <p><strong>Email:</strong> <%= user.email %></p>
        <p><strong>Goal:</strong> <%= user.goal %></p>
        <form action="/logout" method="POST">
          <button type="submit" class="logout-btn">Logout</button>
        </form>
      </div>
    </div>
  </div>

  <div class="dashboard-container">
    <h1>Welcome, <span><%= user.name %></span></h1>

    <!-- Link to generate AI weekly plan -->
    <a href="/ai-plan" class="generate-plan-btn">Generate AI Weekly Plan ğŸ‹ï¸</a>

    <% if (typeof weeklyPlan !== "undefined" && weeklyPlan.length > 0) { %>
    <p>âœ… Progress: <span id="completedCount">0</span> / 7 days completed</p>

    <form action="/save-progress" method="POST">
      <% weeklyPlan.forEach((day, index) => { %>
        <div class="day-card">
          <div class="workout-title"><%= day.day %>: <%= day.workout %></div>

          <% if(day.exercises) { %>
            <ul class="exercise-list">
              <% day.exercises.forEach(ex => { %>
                <li><%= ex %></li>
              <% }) %>
            </ul>
          <% } %>

          <div class="card-footer">
            <small class="motivation-text">"<%= day.motivation %>"</small>
            <input 
              type="checkbox" 
              name="completedDays[]" 
              value="<%= day.day %>" 
              class="day-checkbox"
              onchange="updateProgress()"
            >
          </div>
        </div>
      <% }) %>

      <button type="submit" class="save-btn">Save Progress âœ…</button>
    </form>
    <% } %>

    <div id="dynamicMotivation" class="motivation-box">
      ğŸŒ± Start today, your body will thank you!
    </div>
  </div>

  <script>
    // Profile Dropdown
    function toggleMenu() {
      document.getElementById("profileMenu").classList.toggle("show");
    }

    window.onclick = function(e) {
      if (!e.target.matches('.profile-icon')) {
        let menu = document.getElementById("profileMenu");
        if (menu.classList.contains("show")) {
          menu.classList.remove("show");
        }
      }
    }

    // Progress Bar & Motivation
    function updateProgress() {
      const checkboxes = document.querySelectorAll('.day-checkbox');
      const completed = Array.from(checkboxes).filter(cb => cb.checked).length;
      document.getElementById("completedCount").innerText = completed;

      const messages = [
        "ğŸŒŸ Consistency is better than perfection!",
        "ğŸ”¥ Great start! You've got this!",
        "ğŸ’ª Two days down! Feeling stronger?",
        "ğŸš€ Almost halfway! Keep the momentum!",
        "âš¡ You're a machine! Keep going!",
        "ğŸ† So close to a perfect week!",
        "ğŸ‘‘ Final stretch! Finish strong!",
        "ğŸ‰ BOOM! Week completed! You're a legend!"
      ];

      document.getElementById("dynamicMotivation").innerText = messages[completed];
    }
  </script>
</body>
</html>

